<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>adacad-weaver documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">adacad-weaver documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li>Interfaces</li>
  <li
  >
  Performable</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/player/model/playerop.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p><code>Performable</code> means anything that runs a <code>perform</code> function to generate a Draft.</p>

            </p>


        <section>
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#perform" 
>
                                            perform
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section>
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="perform"></a>
                                        <span class="name "><b>perform</b>
                                            <a href="#perform">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>perform:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/function" target="_blank" >function</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/function" target="_blank" >function</a></code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Function that takes an initla PlayerState and returns a resulting PlayerState</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import utilInstance from &quot;../../core/model/util&quot;;
import { Draft } from &quot;../../core/model/datatypes&quot;;
import { wefts } from &quot;../../core/model/drafts&quot;;
import { 
  BaseOp as Op, BuildableOperation as GenericOp, 
  Seed, Pipe, AllRequired, DraftsOptional, 
  ParamValue, NumParam, OperationParam
} from &quot;../../mixer/model/operation&quot;;
import { PlayerState, initState, copyState } from &quot;./state&quot;;

import { cloneDeep } from &quot;lodash&quot;;

/** classifies operations in the player */
export type PlayerOpClassifier &#x3D; GenericOp[&quot;classifier&quot;][&quot;type&quot;] | &#x27;prog&#x27; | &#x27;chain&#x27; | &#x27;struct&#x27;;

/** the thing that calls an operation&#x27;s perform */
type PerformTrigger &#x3D; &#x27;pedal&#x27; | &#x27;seq&#x27; | &#x27;none&#x27;;

/** 
 * &#x60;Performable&#x60; means anything that runs a &#x60;perform&#x60; function to generate a Draft. 
 * @method &#x60;perform&#x60; The function that generates a Draft
 */
export interface Performable { 
  /** Function that takes an initla PlayerState and returns a resulting PlayerState */
  perform: (init: PlayerState, ...args) &#x3D;&gt; Promise&lt;PlayerState&gt;; 
}

/** The &quot;do nothing&quot; perform */
export const defaultPerform &#x3D; (init: PlayerState) &#x3D;&gt; { 
  let res &#x3D; copyState(init);
  return Promise.resolve(res);
}

/** 
 * A Performable whose effect is determined by the combination of other perform functions. 
 * @property {Array&lt;Performable&gt;} &#x60;ops&#x60; An array of Performables to execute in order.
 * @method &#x60;addOp&#x60; Add a Performable to the end of the array
 * @method &#x60;removeOp&#x60; Remove a Performable from the end of the array
 * @method &#x60;delOpAt&#x60;
 * @method &#x60;insertOpAt&#x60;
 */
export interface CompoundPerformable extends Performable {
  /** An array of Performables to execute in order. */
  ops: Array&lt;Performable&gt;;
  /** Add a Performable to the end of the &#x60;ops&#x60; array */
  addOp: (o: Performable) &#x3D;&gt; any;
  /** Remove a Performable from the end of the &#x60;ops&#x60; array */
  removeOp: () &#x3D;&gt; any;
  /** Delete the Performable at position &#x60;x&#x60; */
  delOpAt: (x: number) &#x3D;&gt; any;
  /** 
   * Insert a Performable at position &#x60;x&#x60; 
   * @param o The Performable
   * @param x Position/index
   */
  insertOpAt: (o: Performable, x: number) &#x3D;&gt; any;
}

/** 
 * Mixer-like parameterized operations. Each operation&#x27;s base 
 * can be loaded into multiple instances with unique 
 * parameter values. 
 */
export interface SingleOpTemplate extends Performable {
  id: number,
  classifier: PlayerOpClassifier,
  name: string,
  dx?: string,
  params: Array&lt;OperationParam&gt;,
}

/**
 * An operation created from a Draft loaded from the Mixer
 */
export interface CustomStructOp extends Performable {
  id: number,
  classifier: &#x27;struct&#x27;,
  name: string,
  gen_name?: string, /** automatically generated draft name */
  params: Array&lt;OperationParam&gt;,
  struct_id: number,
  custom_check: number,
}

/** 
 * OpTemplates are the base versions of any operations that 
 * are mapped in the Draft Player (added to sequencer or 
 * paired with pedals) 
 */
export type OpTemplate &#x3D; SingleOpTemplate | CustomStructOp &amp; { trigger: never };

/**
 * OpInstances are copies of an OpTemplate that keep an 
 * independent set of parameter values, and call the 
 * template&#x27;s perform function using these values.
 */
export interface BaseOpInstance extends Performable {
  /** A generated unique ID number */
  id: number,
  /** Name of the operation (matches template) */
  name: string,
  /** See {@link PlayerOpClassifier} */
  classifier: OpTemplate[&#x27;classifier&#x27;],
  /** What calls the operation&#x27;s &#x60;perform&#x60; method. */
  trigger?: PerformTrigger,
  /** Template for this instance */
  template?: Performable,
  /** Parameters of this oepration  */
  params: Array&lt;OperationParam&gt;,
}

/** An instance of a single operation and its parameters. */
export interface SingleOpInstance extends BaseOpInstance {
  id: number,
  name: string,
  template: SingleOpTemplate,
  perform: SingleOpTemplate[&quot;perform&quot;],
}

/** An instance of a custom structure operation */
export interface StructOpInstance extends BaseOpInstance {
  id: number,
  classifier: &#x27;struct&#x27;,
  template: CustomStructOp,
  perform: CustomStructOp[&quot;perform&quot;],
}

/** union of op instance types */
export type OpInstance &#x3D; SingleOpInstance | StructOpInstance | BaseOpInstance;

/**
 * Helper function to generate an instance of an OpTemplate
 * @param {OpTemplate} base 
 * @returns instance of the OpTemplate
 */
export function newOpInstance(base: OpTemplate): OpInstance {
  const inst &#x3D; {
    id: utilInstance.generateId(8),
    name: base.name,
    classifier: base.classifier,
    template: base, 
    params: cloneDeep(base.params),
    perform: (init: PlayerState) &#x3D;&gt; { 
      // console.log(inst.params);
      return inst.template.perform(init, getParamVals(inst.params)); 
    }
  };
  return inst;
}

/** @function getParamVals Helper function to turn an array of OperationParams into an array of their values */
export function getParamVals(params: Array&lt;OperationParam&gt;): Array&lt;ParamValue&gt; {
  if (!params || params.length &#x3D;&#x3D; 0) {
    return [] as Array&lt;ParamValue&gt;;
  }
  return params.map((el) &#x3D;&gt; el.value);
}

/** A player-specific function to progress through the draft */
export const forward: SingleOpTemplate &#x3D; {
  id: -1,
  name: &#x27;forward&#x27;,
  classifier: &#x27;prog&#x27;,
  params: &lt;Array&lt;NumParam&gt;&gt; [{
    name: &#x27;step size&#x27;,
    dx: &#x27;the number of rows to move forward&#x27;,
    type: &#x27;number&#x27;,
    min: 1,
    max: 100,
    value: 1,
  }],
  perform: (init: PlayerState) &#x3D;&gt; { 
    let res &#x3D; copyState(init);
    res.row &#x3D; (init.row+1) % wefts(init.draft.drawdown);
    res.pedal &#x3D; &#x27;forward&#x27;;
    if (res.weaving) res.numPicks++;
    return Promise.resolve(res); 
  }
}

/** A player-specific function to progress through the draft (re-sends the row to give more time) */
export const refresh: SingleOpTemplate &#x3D; {
  id: -1,
  name: &#x27;refresh&#x27;,
  classifier: &#x27;prog&#x27;,
  params: [],
  perform: defaultPerform,
}

/** A player-specific function to progress backwards through the draft */
export const reverse: SingleOpTemplate &#x3D; {
  id: -1,
  name: &#x27;reverse&#x27;,
  classifier: &#x27;prog&#x27;,
  params: &lt;Array&lt;NumParam&gt;&gt; [{
    name: &#x27;step size&#x27;,
    dx: &#x27;the number of rows to move backward&#x27;,
    type: &#x27;number&#x27;,
    min: 1,
    max: 100,
    value: 1,
  }],
  perform: (init: PlayerState) &#x3D;&gt; { 
    let res &#x3D; copyState(init);
    res.row &#x3D; (init.row+wefts(init.draft.drawdown)-1) % wefts(init.draft.drawdown);
    res.pedal &#x3D; &#x27;reverse&#x27;;
    if (res.weaving) res.numPicks++;
    return Promise.resolve(res);
  }
}

/** Player-specific operations representing progress within a Draft. */
export type ProgressOp &#x3D; OpTemplate | OpInstance &amp; { name: &#x27;forward&#x27; | &#x27;refresh&#x27; | &#x27;reverse&#x27; };

/** Function that converts a general AdaCAD operation to a Player operation. */
export function playerOpFrom(op: GenericOp, params?: Array&lt;ParamValue&gt;) {
  let player_params &#x3D; cloneDeep(op.params);
  if (params) {
    player_params.forEach((el, i) &#x3D;&gt; {
      el.value &#x3D; params[i];
    });
  }
  var p: SingleOpTemplate &#x3D; {
    id: -1, 
    name: op.name,
    classifier: op.classifier.type,
    params: player_params,
    dx: op.dx,
    perform: defaultPerform,
  }

  if (p.classifier &#x3D;&#x3D;&#x3D; &#x27;pipe&#x27;) {
    const pipeOp &#x3D; op as Op&lt;Pipe, AllRequired&gt;;
    p.perform &#x3D; function(init: PlayerState, params?: Array&lt;ParamValue&gt;) {
      let input_params &#x3D; params ? params : getParamVals(op.params);
      let res &#x3D; copyState(init);
      res.draft &#x3D; pipeOp.perform(init.draft, input_params);
      res.row &#x3D; (init.row) % wefts(res.draft.drawdown);
      res.pedal &#x3D; op.name;
      return Promise.resolve(res);
    }
  } else if (p.classifier &#x3D;&#x3D;&#x3D; &#x27;seed&#x27;) {
    const seedOp &#x3D; op as Op&lt;Seed, DraftsOptional&gt;;
    p.perform &#x3D; function(init: PlayerState, params?: Array&lt;ParamValue&gt;) {
      let input_params &#x3D; params ? params : getParamVals(op.params);
      let res &#x3D; copyState(init);
      res.draft &#x3D; seedOp.perform(input_params);
      res.row &#x3D; (init.row) % wefts(res.draft.drawdown);
      res.pedal &#x3D; op.name;
      return Promise.resolve(res);
    }
  }
  
  return p;
}

</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'Performable.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
